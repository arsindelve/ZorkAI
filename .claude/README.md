# Claude Code Configuration

This directory contains configuration for Claude Code sessions.

## Files

### SessionStart (Hook)
Executable bash script that runs when a Claude Code session starts. It:
1. Checks for cached NuGet packages at `.claude/nuget-packages.tar.gz`
2. Extracts the cache to `~/.nuget/packages` if present
3. Runs `dotnet restore` to prepare the build environment

### settings.local.json
Permissions configuration allowing specific bash commands to run without user approval.

### nuget-packages.tar.gz (Auto-generated, not checked in)
Cached NuGet packages to enable offline builds in Claude Code sessions.

**This file is automatically generated** by the MSBuild hook in `Directory.Build.targets` after every `dotnet restore`.

**Note:** This file is excluded from git via `.gitignore` because it's large (~100-500MB typically) and user-specific.

## How It Works

### Automatic Cache Generation
The repository's `Directory.Build.targets` file includes a post-restore hook that:
1. Runs after every `dotnet restore` (CLI, IDE, or automatic)
2. Creates a tarball of `~/.nuget/packages`
3. Saves it to `.claude/nuget-packages.tar.gz`
4. Only runs if the `.claude/` directory exists

This means the cache is **always up-to-date** with your local packages - no manual maintenance required.

### Claude Code Session Startup
When a Claude Code session starts:
1. SessionStart hook checks for the tarball
2. Extracts it to the sandbox's `~/.nuget/packages`
3. Runs `dotnet restore` (fast, uses extracted cache)
4. `dotnet build` and `dotnet test` now work locally

## Why This Setup?

Claude Code sessions run in sandboxed environments with restricted network access. By pre-caching NuGet packages:
- `dotnet build` and `dotnet test` can run locally during development
- Tests can be validated before pushing to CI/CD
- Development workflow is faster and more reliable

## First Time Setup

1. **Run restore once to generate the cache:**
   ```bash
   dotnet restore
   ```
   The MSBuild hook will automatically create `.claude/nuget-packages.tar.gz`

2. **Start Claude Code session:**
   - SessionStart hook automatically extracts cached packages
   - `dotnet build` and `dotnet test` work immediately

## Ongoing Usage

**Zero maintenance required!** The cache automatically updates whenever you:
- Run `dotnet restore`
- Add/update/remove packages
- Restore from Visual Studio, Rider, or VS Code

The tarball stays in sync with your local NuGet packages automatically.
